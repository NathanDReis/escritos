<div class="space-y-8">
    <div>
        <h2 class="text-3xl font-serif font-bold text-slate-800 tracking-tight">
            Dashboard
        </h2>
        <p class="text-slate-500 mt-1">
            VisÃ£o geral e mÃ©tricas da biblioteca.
        </p>
    </div>

    <!-- RANKING DE LEITORES -->
    @if (ranking) {
    <div class="bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden">
        <!-- Header -->
        <div class="px-8 pt-8 pb-4 bg-gradient-to-br from-slate-800 to-slate-700">
            <div class="flex items-center gap-2 mb-1">
                <svg xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 -960 960 960" width="22px" fill="#fbbf24"><path d="M160-200h160v-320H160v320Zm240 0h160v-560H400v560Zm240 0h160v-200H640v200ZM80-120v-480l240-240 240 240 240-240v720H80Z"/></svg>
                <h3 class="font-bold text-white text-lg">Ranking de Leitores</h3>
            </div>
            <p class="text-slate-400 text-xs">Maiores leitores da biblioteca este ano</p>
        </div>

        <!-- PÃ“DIO (Top 3) -->
        <div class="bg-gradient-to-b from-slate-700 to-slate-50 px-8 pb-0 pt-6">
            <div class="flex items-end justify-center gap-4">
                @for (reader of getPodiumOrder(ranking.slice(0, 3)); track reader.userId) {
                <div class="flex flex-col items-center"
                    [class.scale-110]="reader.position === 1"
                    [class.z-10]="reader.position === 1"
                    [class.relative]="reader.position === 1">

                    <!-- Coroa para 1Âº lugar -->
                    @if (reader.position === 1) {
                    <div class="text-2xl mb-1 animate-bounce">ðŸ‘‘</div>
                    }

                    <!-- Avatar -->
                    <div class="relative">
                        <div class="rounded-full flex items-center justify-center font-bold text-white shadow-lg ring-4 transition-all"
                            [style.background-color]="reader.avatarColor"
                            [class.w-16]="reader.position !== 1"
                            [class.h-16]="reader.position !== 1"
                            [class.text-lg]="reader.position !== 1"
                            [class.w-20]="reader.position === 1"
                            [class.h-20]="reader.position === 1"
                            [class.text-2xl]="reader.position === 1"
                            [class.ring-yellow-400]="reader.position === 1"
                            [class.ring-slate-300]="reader.position === 2"
                            [class.ring-amber-600]="reader.position === 3"
                            [class.ring-white]="!isCurrentUser(reader)"
                            [class.ring-green-400]="isCurrentUser(reader)">
                            {{ getInitials(reader.name) }}
                        </div>
                        <!-- Badge vocÃª -->
                        @if (isCurrentUser(reader)) {
                        <span class="absolute -bottom-1 left-1/2 -translate-x-1/2 bg-green-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded-full whitespace-nowrap shadow">VocÃª</span>
                        }
                        <!-- Badge posiÃ§Ã£o -->
                        <span class="absolute -top-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center text-xs font-black text-white shadow-md"
                            [class.bg-yellow-400]="reader.position === 1"
                            [class.text-yellow-900]="reader.position === 1"
                            [class.bg-slate-400]="reader.position === 2"
                            [class.bg-amber-600]="reader.position === 3"
                            [class.w-6]="reader.position === 1"
                            [class.h-6]="reader.position === 1">
                            {{ reader.position }}
                        </span>
                    </div>

                    <!-- Nome -->
                    <div class="mt-3 text-center max-w-[90px]">
                        <p class="text-xs font-bold text-slate-800 leading-tight truncate"
                            [class.text-sm]="reader.position === 1">
                            {{ reader.name.split(' ')[0] }}
                        </p>
                        <p class="text-[10px] text-slate-500 mt-0.5 font-medium">{{ reader.totalLoans }} livros</p>
                    </div>

                    <!-- Plataforma do pÃ³dio -->
                    <div class="mt-3 w-24 rounded-t-lg flex items-center justify-center"
                        [class.h-12]="reader.position === 2"
                        [class.h-20]="reader.position === 1"
                        [class.h-8]="reader.position === 3"
                        [class.bg-slate-300]="reader.position === 2"
                        [class.bg-yellow-400]="reader.position === 1"
                        [class.bg-amber-600]="reader.position === 3">
                        <span class="font-black text-white text-lg opacity-60">{{ reader.position }}Â°</span>
                    </div>
                </div>
                }
            </div>
        </div>

        <!-- LISTA (4Âº e 5Âº) -->
        <div class="px-8 pt-4 pb-2">
            <div class="space-y-2">
                @for (reader of ranking.slice(3, 5); track reader.userId) {
                <div class="flex items-center gap-4 p-3 rounded-xl transition-all duration-200"
                    [class.bg-green-50]="isCurrentUser(reader)"
                    [class.border]="isCurrentUser(reader)"
                    [class.border-green-200]="isCurrentUser(reader)"
                    [class.hover:bg-slate-50]="!isCurrentUser(reader)"
                    [class.bg-slate-50]="!isCurrentUser(reader)">

                    <!-- PosiÃ§Ã£o -->
                    <span class="w-7 h-7 rounded-full bg-slate-200 text-slate-600 flex items-center justify-center text-xs font-black flex-shrink-0">
                        {{ reader.position }}
                    </span>

                    <!-- Avatar -->
                    <div class="relative flex-shrink-0">
                        <div class="w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold text-white"
                            [style.background-color]="reader.avatarColor">
                            {{ getInitials(reader.name) }}
                        </div>
                        @if (isCurrentUser(reader)) {
                        <span class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></span>
                        }
                    </div>

                    <!-- Info -->
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2">
                            <p class="text-sm font-semibold text-slate-800 truncate">{{ reader.name }}</p>
                            @if (isCurrentUser(reader)) {
                            <span class="text-[10px] bg-green-100 text-green-700 font-bold px-1.5 py-0.5 rounded-full flex-shrink-0">VocÃª</span>
                            }
                        </div>
                        <p class="text-xs text-slate-400">{{ reader.email }}</p>
                    </div>

                    <!-- Total -->
                    <div class="text-right flex-shrink-0">
                        <p class="text-sm font-black text-slate-800">{{ reader.totalLoans }}</p>
                        <p class="text-[10px] text-slate-400">livros lidos</p>
                    </div>
                </div>
                }
            </div>
        </div>

        <!-- EXPANSÃƒO (demais posiÃ§Ãµes) -->
        @if (showAllRanking()) {
        <div class="px-8 pb-2">
            <div class="space-y-2">
                @for (reader of ranking.slice(5); track reader.userId) {
                <div class="flex items-center gap-4 p-3 rounded-xl transition-all"
                    [class.bg-green-50]="isCurrentUser(reader)"
                    [class.border]="isCurrentUser(reader)"
                    [class.border-green-200]="isCurrentUser(reader)"
                    [class.hover:bg-slate-50]="!isCurrentUser(reader)"
                    [class.bg-white]="!isCurrentUser(reader)">

                    <span class="w-7 h-7 rounded-full bg-slate-100 text-slate-500 flex items-center justify-center text-xs font-black flex-shrink-0">
                        {{ reader.position }}
                    </span>

                    <div class="relative flex-shrink-0">
                        <div class="w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold text-white"
                            [style.background-color]="reader.avatarColor">
                            {{ getInitials(reader.name) }}
                        </div>
                        @if (isCurrentUser(reader)) {
                        <span class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></span>
                        }
                    </div>

                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2">
                            <p class="text-sm font-semibold text-slate-700 truncate">{{ reader.name }}</p>
                            @if (isCurrentUser(reader)) {
                            <span class="text-[10px] bg-green-100 text-green-700 font-bold px-1.5 py-0.5 rounded-full flex-shrink-0">VocÃª</span>
                            }
                        </div>
                        <p class="text-xs text-slate-400">{{ reader.email }}</p>
                    </div>

                    <div class="text-right flex-shrink-0">
                        <p class="text-sm font-black text-slate-700">{{ reader.totalLoans }}</p>
                        <p class="text-[10px] text-slate-400">livros lidos</p>
                    </div>
                </div>
                }
            </div>
        </div>
        }

        <!-- BotÃ£o Ver mais / Ver menos -->
        <div class="px-8 pb-6 pt-3">
            @if (ranking.length > 5) {
            <button (click)="toggleRanking()"
                class="w-full py-2.5 rounded-xl border border-slate-200 text-slate-600 text-sm font-semibold hover:bg-slate-50 transition-colors cursor-pointer flex items-center justify-center gap-2">
                @if (!showAllRanking()) {
                <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="currentColor"><path d="M480-344 240-584l56-56 184 184 184-184 56 56-240 240Z"/></svg>
                Ver mais colocados
                } @else {
                <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="currentColor"><path d="M480-528 296-344l-56-56 240-240 240 240-56 56-184-184Z"/></svg>
                Ver menos
                }
            </button>
            }
        </div>
    </div>
    }

    @if (stats) {
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div
            class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300">
            <div class="text-slate-400 text-xs font-bold uppercase tracking-wider">
                Total de Livros
            </div>
            <div class="mt-3 text-4xl font-serif font-bold text-slate-800">
                {{ stats.totalBooks }}
            </div>
            <div
                class="flex items-center mt-2 text-emerald-600 bg-emerald-50 w-fit px-2 py-1 rounded-lg text-xs font-semibold">
                <span class="mr-1">â†‘</span> 
                Acervo completo
            </div>
        </div>

        <div
            class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300">
            <div class="text-slate-400 text-xs font-bold uppercase tracking-wider">
                DisponÃ­veis
            </div>
            <div class="mt-3 text-4xl font-serif font-bold text-slate-800">
                {{ stats.availableBooks }}
            </div>
            <div
                class="flex items-center mt-2 text-blue-600 bg-blue-50 w-fit px-2 py-1 rounded-lg text-xs font-semibold">
                Par emprÃ©stimo
            </div>
        </div>

        <div
            class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300">
            <div class="text-slate-400 text-xs font-bold uppercase tracking-wider">
                EmprÃ©stimos
            </div>
            <div class="mt-3 text-4xl font-serif font-bold text-slate-800">
                {{ stats.activeLoans }}
            </div>
            <div
                class="flex items-center mt-2 text-amber-600 bg-amber-50 w-fit px-2 py-1 rounded-lg text-xs font-semibold">
                Ativos agora
            </div>
        </div>

        <div
            class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300">
            <div class="text-slate-400 text-xs font-bold uppercase tracking-wider">
                Leitores
            </div>
            <div class="mt-3 text-4xl font-serif font-bold text-slate-800">
                {{ stats.totalUsers }}
            </div>
            <div
                class="flex items-center mt-2 text-slate-500 bg-slate-50 w-fit px-2 py-1 rounded-lg text-xs font-semibold">
                Cadastrados
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2 bg-white p-8 rounded-2xl border border-slate-100 shadow-sm">
            <div class="flex items-center justify-between mb-8">
                <h3 class="font-bold text-slate-800 text-lg">
                    MovimentaÃ§Ã£o Mensal
                </h3>
                <select
                    class="bg-slate-50 border-none text-xs font-semibold text-slate-500 rounded-lg px-3 py-2 cursor-pointer outline-none hover:bg-slate-100 transition-colors">
                    <option>Ãšltimos 12 meses</option>
                    <option>Ãšltimos 6 meses</option>
                </select>
            </div>

            <div class="h-64 flex items-end justify-between gap-2 px-2">
                @for(h of [40, 60, 30, 80, 50, 90, 70, 40, 60, 80, 50, 75]; track $index) {
                <div class="w-full bg-blue-100 hover:bg-blue-500 rounded-t-lg transition-all duration-300 relative group cursor-pointer"
                    [style.height.%]="h">
                    <span
                        class="absolute -top-10 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-xs py-1 px-2 rounded-lg opacity-0 group-hover:opacity-100 transition-all shadow-lg transform translate-y-2 group-hover:translate-y-0 font-bold">
                        {{h}}
                    </span>
                </div>
                }
            </div>
            <div class="justify-between mt-4 text-xs font-semibold text-slate-400 uppercase tracking-wide px-2 sm:flex hidden">
                <span>Jan</span><span>Fev</span><span>Mar</span><span>Abr</span><span>Mai</span><span>Jun</span>
                <span>Jul</span><span>Ago</span><span>Set</span><span>Out</span><span>Nov</span><span>Dez</span>
            </div>
            <div class="flex justify-between mt-4 text-xs font-semibold text-slate-400 uppercase tracking-wide px-2 sm:hidden">
                <span>J</span><span>F</span><span>M</span><span>A</span><span>M</span><span>J</span>
                <span>J</span><span>A</span><span>S</span><span>O</span><span>N</span><span>D</span>
            </div>
        </div>

        <div class="bg-white p-8 rounded-2xl border border-slate-100 shadow-sm flex flex-col">
            <h3 class="font-bold text-slate-800 text-lg mb-6">
                Categorias Populares
            </h3>
            <div class="space-y-6 flex-1">
                @for(c of ['Ensinos BÃ­blicos', 'Infantil', 'FamÃ­lia', 'Teologia', 'Vida CristÃ£']; track c; let i =
                $index) {
                <div class="group cursor-pointer">
                    <div class="flex justify-between text-sm mb-2">
                        <span class="text-slate-600 font-medium group-hover:text-blue-600 transition-colors">{{ c
                            }}</span>
                        <span class="font-bold text-slate-900">{{ 85 - (i * 12) }}%</span>
                    </div>
                    <div class="h-2 bg-slate-50 rounded-full overflow-hidden">
                        <div class="h-full bg-slate-800 group-hover:bg-blue-600 rounded-full transition-all duration-500 relative overflow-hidden"
                            [style.width.%]="85 - (i * 12)">
                            <div class="absolute inset-0 bg-white/20"></div>
                        </div>
                    </div>
                </div>
                }
            </div>

            <button
                class="w-full mt-6 py-3 rounded-xl border border-slate-200 text-slate-600 text-sm font-semibold hover:bg-slate-50 transition-colors cursor-pointer">
                Ver relatÃ³rio completo
            </button>
        </div>
    </div>
    }
</div>