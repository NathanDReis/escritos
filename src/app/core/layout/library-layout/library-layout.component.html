<div class="flex h-screen bg-slate-50 font-sans text-slate-800">

    @if (isMobileSidebarOpen) {
    <div class="fixed inset-0 bg-black/20 z-20 md:hidden backdrop-blur-sm transition-opacity"
        (click)="closeMobileSidebar()">
    </div>
    }

    <aside
        class="fixed md:static inset-y-0 left-0 w-64 bg-white border-r border-slate-200 flex flex-col z-30 transform transition-transform duration-300 ease-in-out"
        [class.translate-x-0]="isMobileSidebarOpen" [class.-translate-x-full]="!isMobileSidebarOpen"
        [class.md:translate-x-0]="true">
        <div class="p-8 pb-4">
            <div class="flex items-center gap-2 mb-1">
                <div
                    class="w-8 h-8 bg-indigo-900 rounded-lg flex items-center justify-center text-white font-serif font-bold text-xl">
                    E</div>
                <h1 class="text-2xl font-serif font-bold text-slate-800 tracking-tight">
                    Escritos
                </h1>
            </div>
            <p class="text-xs text-slate-400 font-medium pl-10 uppercase tracking-widest">
                Biblioteca
            </p>
        </div>

        <nav class="flex-1 overflow-y-auto px-4 py-6 space-y-1">
            @for (item of menuService.items; track item.id) {
                <a [routerLink]="item.link" routerLinkActive="bg-blue-50 text-blue-700" (click)="closeMobileSidebar()"
                    class="flex items-center px-4 py-3 rounded-xl hover:bg-slate-50 text-slate-500 hover:text-slate-900 transition-all duration-200 group">
                    <span class="mr-3 text-lg opacity-70 group-hover:opacity-100 transition-opacity">
                        <ng-container 
                            *ngComponentOutlet="menuService.getIcon(item.icon)"
                        />
                    </span>
                    <span class="font-medium text-sm">
                        {{ item.title }}
                    </span>
                </a>
            }
        </nav>

        <div class="p-4 border-t border-slate-100">
            <button (click)="logout()"
                class="flex items-center w-full px-4 py-3 text-sm font-medium text-slate-500 hover:text-red-600 hover:bg-red-50 rounded-xl transition-all cursor-pointer">
                <span class="mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                        fill="currentColor">
                        <path
                            d="M440-440q17 0 28.5-11.5T480-480q0-17-11.5-28.5T440-520q-17 0-28.5 11.5T400-480q0 17 11.5 28.5T440-440ZM280-120v-80l240-40v-445q0-15-9-27t-23-14l-208-34v-80l220 36q44 8 72 41t28 77v512l-320 54Zm-160 0v-80h80v-560q0-34 23.5-57t56.5-23h400q34 0 57 23t23 57v560h80v80H120Zm160-80h400v-560H280v560Z" />
                    </svg>
                </span>
                Sair
            </button>
        </div>
    </aside>

    <main class="flex-1 overflow-auto flex flex-col relative w-full">
        <header
            class="bg-white/80 backdrop-blur-md border-b border-slate-200 h-16 flex items-center justify-between px-4 py-2 md:px-8 sticky top-0 z-10 w-full transition-all">

            <div class="flex items-center gap-3">
                <button
                    class="md:hidden p-2 -ml-2 text-slate-500 hover:bg-slate-100 rounded-lg transition-colors cursor-pointer"
                    (click)="toggleMobileSidebar()">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                        fill="currentColor">
                        <path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z" />
                    </svg>
                </button>

                <!-- Breadcrumb -->
                <div class="flex items-center text-sm font-medium text-slate-400">
                    <span class="text-slate-800 sm:block hidden">Biblioteca</span>
                    <span class="mx-2 sm:block hidden">/</span>
                    <span class="text-blue-600">Vis√£o Geral</span>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <button
                    class="w-8 h-8 rounded-full hover:bg-slate-100 flex items-center justify-center text-slate-500 transition-colors cursor-pointer">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                        fill="currentColor">
                        <path
                            d="M80-560q0-100 44.5-183.5T244-882l47 64q-60 44-95.5 111T160-560H80Zm720 0q0-80-35.5-147T669-818l47-64q75 55 119.5 138.5T880-560h-80ZM160-200v-80h80v-280q0-83 50-147.5T420-792v-28q0-25 17.5-42.5T480-880q25 0 42.5 17.5T540-820v28q80 20 130 84.5T720-560v280h80v80H160Zm320-300Zm0 420q-33 0-56.5-23.5T400-160h160q0 33-23.5 56.5T480-80ZM320-280h320v-280q0-66-47-113t-113-47q-66 0-113 47t-47 113v280Z" />
                    </svg>
                </button>

                <div class="h-8 w-px bg-slate-200 mx-1"></div>

                <div class="flex items-center gap-3 pl-2">
                    <div class="text-right hidden sm:block">
                        <div class="text-sm font-semibold text-slate-700 leading-tight">{{ userName() }}</div>
                        <div class="text-xs text-slate-400">
                            Admin
                        </div>
                    </div>
                    <a routerLink="/biblioteca/perfil" class="cursor-pointer">
                        <div
                            class="w-9 h-9 rounded-full bg-slate-100 border border-slate-200 flex items-center justify-center text-blue-700 font-bold text-xs shadow-sm"
                        >
                            @if (userPhotoUrl()) {
                                <img
                                    [src]="userPhotoUrl()"
                                    class="w-full h-full object-cover rounded-xl"
                                />
                            }
                            @else {
                                <p>
                                    {{ userInitials() }}
                                </p>
                            }
                        </div>
                    </a>
                </div>
            </div>
        </header>

        <div class="p-4 md:p-8 max-w-7xl mx-auto w-full">
            <router-outlet></router-outlet>
        </div>
    </main>

</div>